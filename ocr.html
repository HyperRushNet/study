<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OCR AI Demo</title>
</head>
<body>
<h2>OCR AI Demo</h2>

<input type="file" id="imageInput" accept="image/*"><br><br>
<button id="sendButton">Scan Image</button>

<h3>OCR Result:</h3>
<div id="output" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px;"></div>

<script type="module">
import { scanForText } from 'https://hyperrushnet.github.io/study/js/ocr.js?v=' + Date.now();

const imageInput = document.getElementById('imageInput');
const sendButton = document.getElementById('sendButton');
const output = document.getElementById('output');

// Unicode-safe Base64 decode
function base64DecodeUnicode(str) {
  return decodeURIComponent(Array.prototype.map.call(atob(str), c =>
    '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
  ).join(''));
}

sendButton.addEventListener('click', async () => {
  const file = imageInput.files[0];
  if (!file) {
    alert("Please upload an image.");
    return;
  }

  output.textContent = "Processing...";

  const base64 = await new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });

  try {
    const result = await scanForText(base64);
    const decodedText = base64DecodeUnicode(result.base64);
    output.textContent = decodedText;
  } catch (err) {
    output.textContent = "Error: " + err.message;
  }

  imageInput.value = "";
});
</script>
</body>
</html>
