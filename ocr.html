<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OCR AI Demo</title>
</head>
<body>
<h3>OCR AI Demo</h3>

<input type="file" id="imageInput" accept="image/*"><br>
<button id="sendButton">Scan Image</button>

<h4>OCR Text Output:</h4>
<div id="decodedOutput" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px;"></div>

<script type="module">
const moduleUrl = `https://hyperrushnet.github.io/study/js/ocr.js?v=${Date.now()}`;
const { scanForText } = await import(moduleUrl);

const imageInput = document.getElementById("imageInput");
const sendButton = document.getElementById("sendButton");
const decodedOutput = document.getElementById("decodedOutput");

sendButton.addEventListener("click", async () => {
  const file = imageInput.files[0];
  if(!file) return alert("Please upload an image.");

  decodedOutput.textContent = "Processingâ€¦";

  try {
    const base64Image = await fileToBase64(file);
    const result = await scanForText(base64Image);

    // Decode Base64 safely
    const decodedText = decodeURIComponent(escape(atob(result.base64 || "")));
    decodedOutput.textContent = decodedText || "NO TEXT DETECTED";

  } catch(err) {
    decodedOutput.textContent = "Error: " + err;
  }
});

function fileToBase64(file){
  return new Promise((resolve, reject)=>{
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
</script>
</body>
</html>
