<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OCR AI Demo with Emoji</title>
</head>
<body>
<h2>OCR AI Demo</h2>

<input type="file" id="imageInput" accept="image/*"><br>
<button id="scanBtn">Scan Image</button>

<h3>OCR Result:</h3>
<div id="output" style="white-space: pre-wrap; border:1px solid #ccc; padding:10px; margin-top:10px;"></div>

<script type="module">
const outputDiv = document.getElementById("output");
const imageInput = document.getElementById("imageInput");
const scanBtn = document.getElementById("scanBtn");

// Dynamische import met cache-busting
const ocrModule = await import('https://hyperrushnet.github.io/study/js/ocr.js?v=' + Date.now());
const scanForText = ocrModule.scanForText;

// Correcte Base64 decode met UTF-8 (emoji support)
function base64ToUtf8(base64) {
  const binary = atob(base64);
  const bytes = Uint8Array.from(binary, c => c.charCodeAt(0));
  const decoder = new TextDecoder("utf-8");
  return decoder.decode(bytes);
}

scanBtn.addEventListener("click", async () => {
    const file = imageInput.files[0];
    if(!file) {
        alert("Please upload an image.");
        return;
    }

    outputDiv.textContent = "Processingâ€¦";

    const base64 = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });

    try {
        const result = await scanForText(base64);
        if(result.base64) {
            const text = base64ToUtf8(result.base64);
            outputDiv.textContent = text;
        } else {
            outputDiv.textContent = "No text detected.";
        }
    } catch(err) {
        outputDiv.textContent = "Error: " + err;
        console.error(err);
    }
});
</script>
</body>
</html>
